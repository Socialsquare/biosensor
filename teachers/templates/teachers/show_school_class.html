{% extends "base.html" %}
{% load humanize %}

{% block head_title %}Dashboard | {{ block.super }}{% endblock %}

{% block main %}

<h1>
  <strong>{{ school_class.study_field }}</strong>
  - {{ school_class.enrollment_year }}{{ school_class.letter }}
</h1>

<div class="row">
  <div class="col-md-8">
    <h2>Elevgrupper i klassen</h2>
    <a class="m-y-1 btn btn-primary" href="{% url 'teachers:new_student_group' %}">
      <span class="center-y">
        Opret ny elevgruppe
        <svg role="img" class="icon" title="Opret ny elevgruppe">
          <use xlink:href="/static/sprite.svg#sprite_group_add"/>
        </svg>
      </span>
    </a>

    {% if student_groups %}
    <button class="m-y-1 btn btn-secondary edit-mode">
      <span class="center-y">
        Redigér
        <svg role="img" class="icon" title="Rediger gruppe">
          <use xlink:href="/static/sprite.svg#sprite_mode_edit"/>
        </svg>
      </span>
    </button>
      <div class="row">
      {% for group in student_groups %}
        {% ifchanged group.grade group.letter group.year %}
          <div class="m-t-2 col-xs-12">
            <h2>{{group.grade}}.{{group.letter}} {{group.year}}</h2>
          </div>
        {% endifchanged %}
        <div class="col-md-4 m-y-1">
          <div class="student-group">
            <h3 class="student-group__heading">{{group.name}}</h3>
            <a class="student-group__delete" href="{% url 'teachers:delete_student_group' group.id %}">
              <svg role="img" class="icon" title="Slet gruppe">
                <use xlink:href="/static/sprite.svg#sprite_delete"/>
              </svg>
            </a>
            <a class="student-group__edit" href="{% url 'teachers:edit_student_group' group.id %}">
              <svg role="img" class="icon" title="Rediger gruppe">
                <use xlink:href="/static/sprite.svg#sprite_mode_edit"/>
              </svg>
            </a>
          </div>

          {% if group.biosensors_ %}
          <ul class="no-list-style">
            {% for biosensor in group.biosensors_ %}
            <li class="center-y">
              {% if biosensor.has_student_report %}
                <a href="{% url 'teachers:show_student_report' biosensor.student_report.id %}">
              {% endif %}
                  <svg role="img" class="icon" title="Se rapport">
                    <use xlink:href="/static/sprite.svg#sprite_description"/>
                  </svg>
              {% if biosensor.has_student_report %}
                </a>
              {% endif %}
              <a href="{% url 'biobricks:show_biosensor' biosensor.id %}">{{biosensor.name}}</a>
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </div>
      {% endfor %}
      </div>
    {% endif %}

    <h2>Elever i klassen</h2>
    {% for student in school_class.student_set.all %}
      <ul>
        <li>{{ student.user.first_name }} {{ student.user.last_name }}</li>
      </ul>
    {% empty %}
      <p>
        Der er endnu ingen elever oprettet i klassen.
      {% if school_class.school_class_code and school_class.school_class_code.has_expired %}
        Klassekoden er udløbet, opret en ny og del den med klassens elever.
      {% elif school_class.school_class_code %}
        Del klassekoden med klassens elever, så de selv kan oprette deres brugere.
      {% else %}
        Opret og del klassekoden med klassens elever, så de selv kan oprette deres brugere.
      {% endif %}
      </p>
    {% endfor %}
  </div>

  <div class="col-md-4">
    <h2>Klassekode</h2>
    {% if school_class.school_class_code %}
    <div class="card">
      <div class="card-block">
        Kode: <samp>{{ school_class.school_class_code.code }}</samp>
      </div>
      <div class="card-footer text-muted">
        Udløber: {{ school_class.school_class_code.get_expiry|naturaltime }}
      </div>
    </div>
    {% endif %}
    <p>En klassekode kan deles med elever, som derigennem kan oprette brugere
    der tilknyttes jeres klasse.</p>
    <form action="{% url 'teachers:new_school_class_code' school_class.id  %}" method="POST">
      {% csrf_token %}
      <button class="m-y-1 btn btn-primary">
        <span class="center-y">
          {% if school_class.school_class_code %}
            Forny klassekode
          {% else %}
            Opret klassekode
            <svg role="img" class="icon" title="Opret ny invitation">
              <use xlink:href="/static/sprite.svg#sprite_add"/>
            </svg>
          {% endif %}
        </span>
      </button>
    </form>
  </div>
</div>
{% endblock %}
